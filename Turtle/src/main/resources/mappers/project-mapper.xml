<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="projectMapper">

	<resultMap type="project" id="project_rm">
		<id property="projectNo" column="PROJECT_NO"/>
		
		<result property="projectName"  column="PROJECT_NAME"/>
		<result property="projectDescription"  column="PROJECT_DESCRIPTION"/>
		<result property="inviteCode"  column="INVITE_CODE"/>
		<result property="projectDeleteFG"  column="PROJECT_DELETE_FG"/>
		<result property="regDate"  column="REG_DATE"/>
		<result property="createMemberNo"  column="CREATE_MEMBER_NO"/>
		<result property="projectEmoji"  column="PROJECT_EMOJI"/>
		
	</resultMap>
	
 	<insert id="createProject" parameterType="project" useGeneratedKeys="true">
 	
 		<selectKey keyProperty="projectNo" resultType="_int" order="BEFORE">
 			SELECT SEQ_PROJECT_NO.NEXTVAL FROM DUAL
 		</selectKey>
			INSERT INTO PROJECT VALUES(
				#{projectNo},
				#{projectName},
				#{projectDescription},
				#{inviteCode},
				DEFAULT, DEFAULT,
				#{createMemberNo},
				#{projectEmoji}
			)
	
	</insert> 
	
	<insert id="insertPmManager" parameterType="projectMember" useGeneratedKeys="true">

	<selectKey keyProperty="pmNo" resultType="_int" order="BEFORE">
			SELECT SEQ_PM_NO.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT INTO PROJECT_MEMBER VALUES(
			#{pmNo},
			#{projectNo},
			#{memberNo},
			DEFAULT,
			'Y',
			DEFAULT
		)
	</insert>
	
	<!-- 내프로젝트 존재여부 확인 -->
	<select id="selectMyProject" resultType="_int">
		SELECT COUNT(*) FROM PROJECT_MEMBER WHERE MEMBER_NO = ${memberNo} AND PROJECT_MANAGER = 'Y'
	</select>
	
	<select id="selectMyProjectNo" resultType="_int">
		SELECT PROJECT_NO FROM PROJECT_MEMBER WHERE MEMBER_NO = ${memberNo} AND PROJECT_MANAGER = 'Y'
	</select>
	
</mapper>
